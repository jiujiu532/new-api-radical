# 🎉 v1.2.2 - 邀请码系统优化与安全增强

## ✨ 新增功能

### 🎫 邀请码系统重构
- **双类型码支持**：注册码（Type=1）和解封码（Type=2）
- **状态优先级调整**：已用完 > 已过期，更直观的状态显示
- **动态文案显示**：根据码类型自动显示"注册码"或"解封码"
- **删除逻辑优化**：删除过期码时不会影响已用完的码

### 🛡️ 安全优化
- **速率限制默认禁用**：开发环境更友好，避免本地测试时触发 429 错误
- **生产环境可配置**：通过环境变量按需启用速率限制

| 环境变量 | 说明 | 默认值 |
|---------|------|--------|
| `GLOBAL_WEB_RATE_LIMIT_ENABLE` | 启用 Web 速率限制 | `false` |
| `GLOBAL_API_RATE_LIMIT_ENABLE` | 启用 API 速率限制 | `false` |
| `CRITICAL_RATE_LIMIT_ENABLE` | 启用敏感操作速率限制 | `false` |

### 🧹 代码清理
- 删除邀请码页面未使用的"批量禁用"功能
- 删除小黑屋页面未使用的导入（`useNavigate`, `Empty`, `Spin`）
- 统一国际化处理，所有用户可见字符串使用 `t()` 包裹

## 🔧 Bug 修复

| 问题 | 修复 |
|------|------|
| 邀请码删除按钮无法点击 | 修复 Tooltip 嵌套导致的事件拦截 |
| 筛选"已过期"时包含已用完码 | 修正查询条件，排除已用完的码 |
| 删除过期码影响已用完码 | 后端删除逻辑增加排除条件 |

## 📥 下载

| 平台 | 文件 | 大小 |
|------|------|------|
| Linux (amd64) | `new-api-linux-amd64` | ~59 MB |
| Windows (amd64) | `new-api-windows-amd64.exe` | ~61 MB |

## 🔄 升级说明

1. **直接替换**：下载对应平台的二进制文件，直接替换即可
2. **无需迁移**：此版本无数据库变更，升级后数据保持不变

### 生产环境启用速率限制

如需保护您的服务免受滥用，建议在生产环境启用速率限制：

```bash
# Docker Compose 示例
environment:
  - GLOBAL_WEB_RATE_LIMIT_ENABLE=true
  - GLOBAL_WEB_RATE_LIMIT=100
  - GLOBAL_WEB_RATE_LIMIT_DURATION=60
  - CRITICAL_RATE_LIMIT_ENABLE=true
  - CRITICAL_RATE_LIMIT=30
  - CRITICAL_RATE_LIMIT_DURATION=600
```

## 📋 完整变更列表

- `common/init.go` - 速率限制默认禁用
- `controller/invitation_code.go` - 删除逻辑优化
- `model/invitation_code.go` - 筛选逻辑修复
- `web/src/pages/Blacklist/index.jsx` - 代码清理
- `web/src/pages/InvitationCode/index.jsx` - UI 优化与死代码删除

---

**Full Changelog**: https://github.com/jiujiu532/new-api-radical/compare/v1.2.1...v1.2.2
