# 和Newapi上游的区别

1. 实现维护模型健康度（健康度是一个时间的比值，每5分钟一个单位，如果该单位内只有失败的请求，那么记为失败时间片，如果有一个或多个成功请求并且（返回的byte长度大于1k或完成token大于2或实际响应模型回复大于2char），记为成功时间片，可查看不同小时时间段的模型成功率），实现后端和对应前端，，设计数据结构和新表实现良好性能。实现对非管理员隐藏可自定义模型和时间的查询（在控制台），并实现在导航栏添加新的页面（新页面所有用户即使非登录也可查看），显示所有模型最近24小时每小时的健康度。【已实现】
2. 若Newapi无法实现在对所有用户限速的情况下，使用标签解除对应的限速（而不是其他限速），那么添加管理员豁免用户限速RPM【已实现】
3. 实现缓存最近100次API调用的请求和返回信息到内存里（包括报错，记录客户端原始请求和上游原始响应（包括上游原始流式响应）），提供UI查阅，实现后端和对应前端，设计数据结构和新表实现良好性能【已实现】
4. 实现按可选定的小时统计用户的总调用次数（可分别显示成功次数或报错次数）并降序显示，实现后端和对应前端，设计数据结构和新表实现良好性能【已实现】
5. 实现生成随机兑换码（输入最小值和最大值，以及其他普通兑换码具有的字段，并且支持设置生成的兑换码前缀，生成随机的兑换码并提供文件下载），实现后端和对应前端【已实现】
6. 实现模型自定义配置没有将特定role转换为另一种role的功能的话实现它。不是全局模型映射，而是每个渠道一个配置，加入渠道额外设置
7. 实现强制在日志记录IP，即使用户关闭IP记录【已实现】
8. web\public\oauth-redirect.html 多站点重定向登录【已实现】
9. 实现接入 fingerprintjs/fingerprintjs 库，记录用户的历史5次visitor id（去重后的5次），并实现管理员查询相同visitor id的用户，也就是说创建一个管理员可见的在工作台的面板，面板名称4个字【已实现】
10. 实现维护每个用户100个槽，储存在内存中，每个槽是一次哈希和时间的记录，在8,64,512...长度的多个哈希结果（每个仅保存6位）。每当遇到请求时，都先计算哈希并和槽进行比较，如果能继承，那么继承并覆盖，否则LRU占用新槽。接下来实现一个查询页面，展示用户在30秒内的活跃任务数（即槽数）feat: 活跃任务槽追踪系统 - 全局1000槽/单用户50槽上限，多级哈希匹配，LRU淘汰策略，管理员查询页面。【已实现】添加功能：实现每600秒扫描一次，如果发现活跃任务数在5（600s）以上的记录到新表 可查询【已实现】实现记录的用户可点击查看其24小时内消耗的不同模型的多少token
11. 合并上游的签到更新。添加是否开启随机额度功能【已实现】